# PR-007: ZusÃ¤tzliche Export-Formate (DOCX, MD, TXT)

**Status:** ðŸŸ¢ Erledigt
**PrioritÃ¤t:** ðŸ’¤ Niedrig
**Typ:** âœ¨ Feature
**Erstellt:** 2026-02-18
**Erledigt:** 2026-02-19

## Beschreibung
Neben dem bestehenden PDF-Export sollen drei weitere Export-Formate angeboten werden: DOCX, Markdown und Plain Text.

## Aktueller Zustand
Nur PDF-Export vorhanden.

## GewÃ¼nschter Zustand
Export-Optionen:
- **PDF** (bereits vorhanden, wird in PR-006 verbessert)
- **DOCX** â€“ Word-Dokument mit korrekter Formatierung
- **MD** â€“ Markdown-Datei
- **TXT** â€“ Plain Text ohne Formatierung

### Wichtige Anforderungen
- **DOCX:** Markdown muss sauber in Word-Formatierung umgesetzt werden (Ãœberschriften, Fett, Kursiv, Listen). Keine rohen MD-Zeichen im Dokument. Besondere Vorsicht bei der MDâ†’DOCX-Konvertierung.
- **MD:** Saubere Markdown-Datei, direkt verwendbar
- **TXT:** Reiner Text, Formatierungszeichen entfernt
- Alle Formate mÃ¼ssen von Anfang an korrekt dargestellt werden
- PHORO Read Logo wo sinnvoll einbinden (DOCX: ja, MD/TXT: nein)

## Betroffene Dateien
- [x] `src/lib/text-parser.ts` â€” Neu: Shared Typen + Parsing-Funktionen (extrahiert aus page.tsx)
- [x] `src/lib/export.ts` â€” Neu: Alle 4 Export-Funktionen (PDF, DOCX, MD, TXT)
- [x] `src/components/ui/dropdown-menu.tsx` â€” Neu: shadcn/ui DropdownMenu-Komponente
- [x] `src/app/page.tsx` â€” Refactored: Export-Code extrahiert, PDF-Button â†’ Export-Dropdown

## Umsetzungsschritte
- [x] Bestehenden PDF-Export als Referenz analysieren
- [x] DOCX-Export implementieren (Library: `docx` npm-Paket)
- [x] MD-Export implementieren
- [x] TXT-Export implementieren
- [x] Export-UI erweitern (Dropdown mit 4 Optionen: PDF, Word, Markdown, Text)
- [ ] Alle Formate mit verschiedenen Texten testen (manuell)
- [ ] Zusammenspiel mit PR-008 beachten (Open Dyslexic in DOCX)

## Umsetzungsdetails

### Architektur
- **text-parser.ts**: `TextBlock`/`StyledSegment` Typen, `parseInlineSegments()`, `parseTextBlocks()`, `stripMarkdown()` â€” alles aus page.tsx extrahiert + neuer Markdown-Stripper
- **export.ts**: `exportPdf()` (aus page.tsx verschoben), `exportDocx()` (via `docx`-Library mit Logo, Headings, Listen, Bold/Italic), `exportMarkdown()` (currentText + Header), `exportPlainText()` (stripMarkdown + Header)
- **page.tsx**: ~200 Zeilen weniger, sauberer `handleExport(format)` Dispatcher

### Dependencies
- `docx` â€” DOCX-Generierung (dynamisch importiert)
- `@radix-ui/react-dropdown-menu` â€” via shadcn/ui
- `@types/jspdf` entfernt (veraltet, kollidierte mit jsPDF v4 eigenen Typen)

### UI
Toolbar: `[Vorlesen] [Fokus] [Abstand] [Export â–¾]` â€” Dropdown mit PDF, Word (DOCX), Markdown, Text

## Notizen
- DOCX nutzt Calibri als Systemfont (Lexend kann nicht in DOCX eingebettet werden ohne Font-Binary)
- Bei PR-008 (Open Dyslexic) muss die DOCX-Font-Logik angepasst werden
