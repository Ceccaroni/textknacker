# PR-009: Bildbearbeitung vor Analyse (Crop, Helligkeit, Kontrast)

**Status:** üü¢ Erledigt
**Priorit√§t:** ‚ö° Mittel
**Typ:** ‚ú® Feature
**Erstellt:** 2026-02-18
**Erledigt:** 2026-02-19

## Beschreibung
Wenn ein User ein Foto macht oder hochl√§dt, muss er es **vor der Analyse** bearbeiten k√∂nnen. Ziel: Exakte Textbl√∂cke ausw√§hlen (z.B. aus B√ºchern mit Bildern) und die Bildqualit√§t f√ºr die OCR/Analyse optimieren.

## Umsetzung

### ImageEditor-Komponente
- [x] `src/components/image-editor.tsx` mit Crop, Helligkeit, Kontrast
- [x] react-image-crop Library integriert, touch-f√§hig
- [x] shadcn/ui Slider f√ºr Helligkeit/Kontrast (50‚Äì150%)
- [x] CSS-Filter Live-Vorschau (GPU-beschleunigt)
- [x] Canvas-Verarbeitung bei Best√§tigung (Crop + Filter ‚Üí base64 JPEG)
- [x] Editor √∂ffnet sich inline im Kamera-Tab nach Foto/Upload
- [x] Kamera-Stream wird gestoppt wenn Editor offen
- [x] Zur√ºcksetzen-Button, Abbrechen-Button
- [x] Fehleranzeige im Editor (bleibt offen bei Fehler, Retry m√∂glich)
- [x] Loading-State mit Spinner + "Text wird erkannt..."

### OCR-Submission (Fix)
- [x] **Ursache:** Next.js Server Action Body-Size-Limit (Default 1 MB) ‚Äî iPhone-Fotos als base64 sind 3‚Äì7 MB
- [x] **Fix 1:** `experimental.serverActions.bodySizeLimit: '10mb'` in `next.config.ts`
- [x] **Fix 2:** Bild-Downscaling auf max 2048px (l√§ngste Seite) + JPEG-Qualit√§t 0.85 vor Senden ‚Äî reduziert auf ~200‚Äì500 KB

## Betroffene Dateien
- `src/components/image-editor.tsx` ‚Äî ImageEditor-Komponente (NEU)
- `src/components/ui/slider.tsx` ‚Äî shadcn/ui Slider (NEU)
- `src/app/page.tsx` ‚Äî Integration: capturedImage State, Editor-Rendering, OCR-Submission
- `src/app/globals.css` ‚Äî react-image-crop CSS-Overrides
- `next.config.ts` ‚Äî Body-Size-Limit f√ºr Server Actions
- `package.json` ‚Äî react-image-crop Dependency

## Nicht in v1 (optional f√ºr sp√§ter)
- Rotation (90¬∞-Schritte)
- Pinch-to-Zoom
- Undo/Redo (Reset-Button reicht)
