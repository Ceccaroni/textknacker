# PR-019: Vorlesefunktion auf OpenAI TTS umstellen

**Status:** üü¢ Erledigt
**Priorit√§t:** üî• Hoch
**Typ:** ‚ú® Feature
**Erstellt:** 2026-02-19
**Erledigt:** 2026-02-21

## Beschreibung
Die aktuelle Vorlesefunktion nutzt die Web Speech API des Browsers. Die Stimmen klingen robotisch und sprechen Fremdsprachen mit dem Akzent der Systemsprache. F√ºr ein mehrsprachiges Schweizer EdTech-Tool inakzeptabel.

## Aktueller Zustand
- Browser Web Speech API (window.speechSynthesis)
- Generische Computerstimme
- Fremdsprachen klingen falsch (z.B. Franz√∂sisch mit deutschem Akzent)

## Gew√ºnschter Zustand
- **OpenAI TTS API** als Ersatz
- Nat√ºrlich klingende Stimmen in allen unterst√ºtzten Sprachen
- Sprache wird automatisch aus dem vereinfachten Text erkannt
- Korrekte Aussprache und nat√ºrlicher Sprachfluss

## Betroffene Dateien
- [x] `src/app/api/tts/route.ts` ‚Äî NEU: API-Route f√ºr OpenAI TTS
- [x] `src/app/page.tsx` ‚Äî Web Speech API ‚Üí Audio-Objekt mit Pause/Resume
- [x] `src/lib/text-parser.ts` ‚Äî truncateAtSentenceBoundary() Hilfsfunktion
- [x] `firebase.json` ‚Äî OPENAI_API_KEY zu secrets hinzuf√ºgen

## Umsetzungsschritte
- [x] Ticket anlegen, TICKETS.md aktualisieren
- [x] truncateAtSentenceBoundary() in text-parser.ts
- [x] API-Route erstellen (Zod, stripMarkdown, truncate, OpenAI fetch, mp3 stream)
- [x] page.tsx umbauen (speechSynthesis raus, Audio-Objekt rein)
- [x] firebase.json aktualisieren
- [x] Build pr√ºfen
- [x] Deployed auf Firebase ‚úÖ
- [x] Fix: Build-Fehler (OPENAI_API_KEY Check von module-level zu runtime verschoben)
- [x] Fix: Audio-Cleanup bei neuem Text (altes Audio wird gestoppt/freigegeben)
- [x] Getestet: Arabisch ‚úÖ, Franz√∂sisch ‚úÖ
- [x] Weitere Sprachen: User best√§tigt Funktionalit√§t

## Technische Details
- Endpoint: `POST https://api.openai.com/v1/audio/speech`
- Modell: `tts-1`
- Stimme: `nova` (Default)
- Output: mp3
- Max Input: 4096 Zeichen ‚Üí Abschneiden an Satzgrenze
- Kein OpenAI SDK n√∂tig ‚Äî direkter fetch-Call

## Notizen
- OpenAI TTS erkennt die Sprache automatisch aus dem Text
- F√ºr R√§toromanisch und Tigrinya nicht offiziell unterst√ºtzt ‚Äî Qualit√§t unklar
- Albanisch (sq) nicht explizit gelistet, k√∂nnte aber funktionieren
- 11 von 13 Sprachen offiziell unterst√ºtzt (DE, FR, IT, EN, ES, PT, NL, TR, MK, SR + RM/TI unsicher)
- Echtes Pause/Resume m√∂glich (besser als Web Speech API)
- Kein OpenAI SDK n√∂tig ‚Äî direkter fetch-Call spart ~2MB Dependency
