# PR-019: Vorlesefunktion auf OpenAI TTS umstellen

**Status:** ðŸŸ¡ In Arbeit
**PrioritÃ¤t:** ðŸ”¥ Hoch
**Typ:** âœ¨ Feature
**Erstellt:** 2026-02-19
**Erledigt:** â€”

## Beschreibung
Die aktuelle Vorlesefunktion nutzt die Web Speech API des Browsers. Die Stimmen klingen robotisch und sprechen Fremdsprachen mit dem Akzent der Systemsprache. FÃ¼r ein mehrsprachiges Schweizer EdTech-Tool inakzeptabel.

## Aktueller Zustand
- Browser Web Speech API (window.speechSynthesis)
- Generische Computerstimme
- Fremdsprachen klingen falsch (z.B. FranzÃ¶sisch mit deutschem Akzent)

## GewÃ¼nschter Zustand
- **OpenAI TTS API** als Ersatz
- NatÃ¼rlich klingende Stimmen in allen unterstÃ¼tzten Sprachen
- Sprache wird automatisch aus dem vereinfachten Text erkannt
- Korrekte Aussprache und natÃ¼rlicher Sprachfluss

## Betroffene Dateien
- [x] `src/app/api/tts/route.ts` â€” NEU: API-Route fÃ¼r OpenAI TTS
- [x] `src/app/page.tsx` â€” Web Speech API â†’ Audio-Objekt mit Pause/Resume
- [x] `src/lib/text-parser.ts` â€” truncateAtSentenceBoundary() Hilfsfunktion
- [x] `firebase.json` â€” OPENAI_API_KEY zu secrets hinzufÃ¼gen

## Umsetzungsschritte
- [x] Ticket anlegen, TICKETS.md aktualisieren
- [x] truncateAtSentenceBoundary() in text-parser.ts
- [x] API-Route erstellen (Zod, stripMarkdown, truncate, OpenAI fetch, mp3 stream)
- [x] page.tsx umbauen (speechSynthesis raus, Audio-Objekt rein)
- [x] firebase.json aktualisieren
- [x] Build prÃ¼fen
- [x] Deployed auf Firebase âœ…
- [x] Fix: Build-Fehler (OPENAI_API_KEY Check von module-level zu runtime verschoben)
- [x] Fix: Audio-Cleanup bei neuem Text (altes Audio wird gestoppt/freigegeben)
- [x] Getestet: Arabisch âœ…, FranzÃ¶sisch âœ…
- [ ] Weitere Sprachen systematisch testen (DE, IT, EN, etc.)

## Technische Details
- Endpoint: `POST https://api.openai.com/v1/audio/speech`
- Modell: `tts-1`
- Stimme: `nova` (Default)
- Output: mp3
- Max Input: 4096 Zeichen â†’ Abschneiden an Satzgrenze
- Kein OpenAI SDK nÃ¶tig â€” direkter fetch-Call

## Notizen
- OpenAI TTS erkennt die Sprache automatisch aus dem Text
- FÃ¼r RÃ¤toromanisch und Tigrinya nicht offiziell unterstÃ¼tzt â€” QualitÃ¤t unklar
- Albanisch (sq) nicht explizit gelistet, kÃ¶nnte aber funktionieren
- 11 von 13 Sprachen offiziell unterstÃ¼tzt (DE, FR, IT, EN, ES, PT, NL, TR, MK, SR + RM/TI unsicher)
- Echtes Pause/Resume mÃ¶glich (besser als Web Speech API)
- Kein OpenAI SDK nÃ¶tig â€” direkter fetch-Call spart ~2MB Dependency
